---
# tasks file for elastic-beats

- rpm_key:
    state: present
    key: https://artifacts.elastic.co/GPG-KEY-elasticsearch

- name: copy elastic.repo
  copy:
    src: elastic.repo
    dest: /etc/yum.repos.d/elastic.repo

- name: install beats
  yum:
    name:
      - filebeat
      - metricbeat

- name: copy filebeat.yml
  copy: 
    src: filebeat.yml
    dest: /etc/filebeat/filebeat.yml

- name: copy metricbeat.yml
  copy: 
    src: metricbeat.yml
    dest: /etc/metricbeat/metricbeat.yml

- name: start filebeat
  systemd:
    name: filebeat
    state: started
    enabled: yes

- name: start metricbeat
  systemd:
    name: metricbeat
    state: started
    enabled: yes
